
-- ENUM TYPES
CREATE TYPE user_role AS ENUM ('stu', 'adm', 'com');
CREATE TYPE college_year_enum AS ENUM ('1', '2', '3', '4', '5');

-- USERS TABLE
CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    role user_role NOT NULL,
    first_name VARCHAR(40) NOT NULL,
    last_name VARCHAR(40) NOT NULL,
    email VARCHAR(40) UNIQUE NOT NULL,
    password VARCHAR(100) NOT NULL,
    course_code VARCHAR(15),
    college_year college_year_enum
);

-- LOGS TABLE
CREATE TABLE logs (
    id SERIAL PRIMARY KEY,
    user_id INTEGER REFERENCES users(id) ON DELETE SET NULL,
    action VARCHAR(255),
    timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- RESIDENCIES TABLE
CREATE TABLE residencies (
    id SERIAL PRIMARY KEY,
    job_title VARCHAR(50),
    job_description TEXT,
    job_slots INTEGER,
    interview_quota INTEGER,
    recruitment_description TEXT,
    company_id INTEGER REFERENCES users(id) ON DELETE SET NULL
);

-- PREFERENCES TABLE
CREATE TABLE preferences (
    id SERIAL PRIMARY KEY,
    student_id INTEGER REFERENCES users(id) ON DELETE CASCADE,
    residency_id INTEGER REFERENCES residencies(id) ON DELETE CASCADE,
    rank_position INTEGER,
    round INTEGER,
    ranking_stage INTEGER
);

-- INTERVIEWS TABLE
CREATE TABLE interviews (
    id SERIAL PRIMARY KEY,
    student_id INTEGER REFERENCES users(id) ON DELETE CASCADE,
    residency_id INTEGER REFERENCES residencies(id) ON DELETE CASCADE,
    score INTEGER
);

-- CVS TABLE
CREATE TABLE cvs (
    id SERIAL PRIMARY KEY,
    student_id INTEGER REFERENCES users(id) ON DELETE CASCADE,
    residency_id INTEGER REFERENCES residencies(id) ON DELETE CASCADE,
    file_url VARCHAR(500),
    uploaded_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- MATCHES TABLE
CREATE TABLE matches (
    id SERIAL PRIMARY KEY,
    student_id INTEGER REFERENCES users(id) ON DELETE CASCADE,
    residency_id INTEGER REFERENCES residencies(id) ON DELETE CASCADE,
    round INTEGER,
    timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
